/*! 
* oakyjs - v0.0.1
* Copyright (c) 2013 oakyjs 
*  
*/ 

!function(a){var b,c,d,e,f,g={".js":[],".json":[],".css":[],".html":[]};return e=function(a){var b=new Error("Could not find module '"+a+"'");return b.code="MODULE_NOT_FOUND",b},f=function(a,b,c){var d,e;if("function"==typeof a[b+c])return b+c;for(d=0;e=g[c][d];++d)if("function"==typeof a[b+e])return b+e;return null},b=function(a,d,g,h,i){var j,k,l,m,n,o;for(g=g.split(/[\\/]/),j=g.pop(),("."===j||".."===j)&&(g.push(j),j="");null!=(k=g.shift());)if(k&&"."!==k&&(".."===k?a=d.pop():(d.push(a),a=a[k]),!a))throw e(h);if(j&&"function"!=typeof a[j]&&(o=f(a,j,".js"),o||(o=f(a,j,".json")),o||(o=f(a,j,".css")),o||(o=f(a,j,".html")),o?j=o:2!==i&&"object"==typeof a[j]&&(d.push(a),a=a[j],j="")),!j)return 1!==i&&a[":mainpath:"]?b(a,d,a[":mainpath:"],h,1):b(a,d,"index",h,2);if(n=a[j],!n)throw e(h);return n.hasOwnProperty("module")?n.module.exports:(l={},n.module=m={exports:l},n.call(l,l,m,c(a,d)),m.exports)},d=function(c,d,f){var g,h=f,i=f.charAt(0),j=0;if("/"===i)h=h.slice(1),c=a["/"],d=[];else if("."!==i){if(g=h.split("/",1)[0],c=a[g],!c)throw e(f);d=[],h=h.slice(g.length+1),h||(h=c[":mainpath:"],h?j=1:(h="index",j=2))}return b(c,d,h,f,j)},c=function(a,b){return function(c){return d(a,[].concat(b),c)}},c(a,[])}({oaky:{lib:{"Base.js":function(a,b){b.exports={create:function(){var a=Object.create(this);return a.initialize.apply(a,arguments),a},extend:function(a,b){if(b=b||{},a)for(var c=Object.getOwnPropertyNames(a),d=0,e=c.length;e>d;d+=1){var f=c[d];b.hasOwnProperty(f)||(b[f]=Object.getOwnPropertyDescriptor(a,f))}return Object.create(this,b)},initialize:function(){},_super:function(a,b,c){return"string"!=typeof b&&(c=b,b="initialize"),Object.getPrototypeOf(a)[b].apply(this,c)}}},"Entity.js":function(a,b,c){var d=c("./Base");b.exports=d.extend({initialize:function(){this.id=null,this.index=-1,this._components={},this._events={}},on:function(a,b){this._events[a]=b},add:function(a,b){this._components[a]=b},get:function(a){return this._components[a]},getAll:function(){return Object.keys(this._components)},has:function(a){return this._components.hasOwnProperty(a)},is:function(a){return this.has(a)},set:function(a,b){return this._components[a]=b,this},remove:function(a){return delete this._components[a],this},clear:function(){for(var a in this._components)this._components.hasOwnProperty(a)&&this.remove(a);return this},destroy:function(){this.clear(),this._events.destroy&&this._events.destroy(this)}})},"EntityManager.js":function(a,b,c){var d=c("./Base"),e=c("./Entity"),f=c("./Pool");b.exports=d.extend({initialize:function(){function a(){var a=e.create();return a.on("destroy",function(a){c.destroyEntity(a)}),a}function b(a,b){a.index=b,a.id=++c.lastId}this.lastId=0;var c=this;this.pool=f.create(a,b)},make:function(){return this.pool.make()},getById:function(a){for(var b=this.pool.elems,c=0;c<b.length;c++)if(b[c].id===a)return b[c];return null},getByComponents:function(a){function b(b){for(var c=0;c<a.length;c++)if(-1===b.indexOf(a[c]))return!1;return!0}for(var c=[],d=this.pool.elems,e=d.length;e--;){var f=d[e].getAll();d[e].id&&b(f)&&c.push(d[e])}return c},get:function(a){if(isNaN(a)){var b=Array.isArray(a)?a:[a];return this.getByComponents(b)}return this.getById(a)},destroyEntity:function(a){a.id=null,this.pool.discard(a.index)}})},"Game.js":function(a,b,c){var d=c("./Base"),e=c("./EntityManager"),f=c("./GameTime");b.exports=d.extend({initialize:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this._components={},this._systems=[],this._systemsByName={},this.entities=e.create(),this.gameTime=new f,this.tLoop=null,this.paused=!1,this.boundGameRun=this.gameRun.bind(this)},addSystem:function(a,b){if(!b)throw new Error("A system was expected");if(this._systemsByName.hasOwnProperty(a))throw new Error("Duplicated system name "+a);this._systemsByName[a]=b,this._systems.push(b),b.game=this},use:function(a,b){if(this._components.hasOwnProperty(a))throw new Error("component '"+a+"' already exist");this._components[a]=b},process:function(){for(var a=0;a<this._systems.length;a++){var b=this._systems[a];if(b.enabled)if(b.uses&&b.uses.length>0){var c=this.entities.get(b.uses);b.process(this.gameTime.frameTime,c)}else b.process(this.gameTime.frameTime)}},enable:function(a){this._systemsByName.hasOwnProperty(a)&&(this._systemsByName[a].enabled=!0)},disable:function(a){this._systemsByName.hasOwnProperty(a)&&(this._systemsByName[a].enabled=!1)},loop:function(){this.process()},start:function(){this.paused=!1,this.gameRun()},stop:function(){this.paused=!0,window.cancelAnimationFrame(this.tLoop)},gameRun:function(){this.gameTime.tick()&&this.loop(),this.tLoop=window.requestAnimationFrame(this.boundGameRun)}})},"GameTime.js":function(a,b){var c=b.exports=function(){this.lastTime=Date.now(),this.frameTime=0,this.typicalFrameTime=20,this.minFrameTime=12,this.time=0};c.prototype.tick=function(){var a=Date.now(),b=a-this.lastTime;return b<this.minFrameTime?!1:(this.frameTime=b>2*this.typicalFrameTime?this.typicalFrameTime:b,this.time+=this.frameTime,this.lastTime=a,!0)},c.prototype.reset=function(){this.lastTime=Date.now(),this.frameTime=0,this.typicalFrameTime=20,this.minFrameTime=12,this.time=0}},"Pool.js":function(a,b,c){var d=c("./Base");b.exports=d.extend({expandFactor:.2,expandMinUnits:16,elems:[],freeElems:[],initialize:function(a,b){this.allocator=a,this.resetor=b,this.elems[0]=this.allocator(),this.freeElems=[0]},make:function(){this.freeElems.length||this.expand();var a=this.freeElems.pop(),b=this.elems[a];return this.resetor(b,a),b},getLength:function(){return this.elems.length-this.freeElems.length},expand:function(){var a=this.elems.length,b=Math.ceil(this.elems.length*this.expandFactor);b<this.expandMinUnits&&(b=this.expandMinUnits),this.elems.length=this.elems.length+b;for(var c=a;c<this.elems.length;c++)this.elems[c]=this.allocator(),this.freeElems.push(c)},discard:function(a){this.freeElems.indexOf(a)>=0||this.freeElems.push(a)},get:function(a){return this.elems[a]}})},"System.js":function(a,b,c){var d=c("./Base");b.exports=d.extend({uses:[],enabled:!0,initialize:function(){},process:function(){}})},"index.js":function(a,b,c){var d=c("./Game");window.oaky=window.oaky||{},window.oaky.createGame=function(a){return d.create(a)},window.oaky.System=c("./System")}}}})("oaky/lib/index");