/*! 
* oakyjs - v0.0.1
* Copyright (c) 2013 oakyjs 
*  
*/ 

!function(a){var b,c,d,e,f,g={".js":[],".json":[],".css":[],".html":[]};return e=function(a){var b=new Error("Could not find module '"+a+"'");return b.code="MODULE_NOT_FOUND",b},f=function(a,b,c){var d,e;if("function"==typeof a[b+c])return b+c;for(d=0;e=g[c][d];++d)if("function"==typeof a[b+e])return b+e;return null},b=function(a,d,g,h,i){var j,k,l,m,n,o;for(g=g.split(/[\\/]/),j=g.pop(),("."===j||".."===j)&&(g.push(j),j="");null!=(k=g.shift());)if(k&&"."!==k&&(".."===k?a=d.pop():(d.push(a),a=a[k]),!a))throw e(h);if(j&&"function"!=typeof a[j]&&(o=f(a,j,".js"),o||(o=f(a,j,".json")),o||(o=f(a,j,".css")),o||(o=f(a,j,".html")),o?j=o:2!==i&&"object"==typeof a[j]&&(d.push(a),a=a[j],j="")),!j)return 1!==i&&a[":mainpath:"]?b(a,d,a[":mainpath:"],h,1):b(a,d,"index",h,2);if(n=a[j],!n)throw e(h);return n.hasOwnProperty("module")?n.module.exports:(l={},n.module=m={exports:l},n.call(l,l,m,c(a,d)),m.exports)},d=function(c,d,f){var g,h=f,i=f.charAt(0),j=0;if("/"===i)h=h.slice(1),c=a["/"],d=[];else if("."!==i){if(g=h.split("/",1)[0],c=a[g],!c)throw e(f);d=[],h=h.slice(g.length+1),h||(h=c[":mainpath:"],h?j=1:(h="index",j=2))}return b(c,d,h,f,j)},c=function(a,b){return function(c){return d(a,[].concat(b),c)}},c(a,[])}({oaky:{lib:{"Base.js":function(a,b){b.exports={create:function(){var a=Object.create(this);return a.initialize.apply(a,arguments),a},extend:function(a,b){if(b=b||{},a)for(var c=Object.getOwnPropertyNames(a),d=0,e=c.length;e>d;d+=1){var f=c[d];b.hasOwnProperty(f)||(b[f]=Object.getOwnPropertyDescriptor(a,f))}return Object.create(this,b)},initialize:function(){},_super:function(a,b,c){return"string"!=typeof b&&(c=b,b="initialize"),Object.getPrototypeOf(a)[b].apply(this,c)}}},"Entity.js":function(a,b,c){var d=c("./Base");b.exports=d.extend({initialize:function(){this.id=null,this.index=-1,this.tags=[],this._components={},this._events={}},on:function(a,b){this._events[a]=b},add:function(a,b){this._components[a]=b},get:function(a){return this._components[a]},getAll:function(){return Object.keys(this._components)},has:function(a){return this._components.hasOwnProperty(a)},set:function(a,b){return this._components[a]=b,this},remove:function(a){return delete this._components[a],this},clear:function(){for(var a in this._components)this._components.hasOwnProperty(a)&&this.remove(a);return this},addTag:function(a){return this.hasTag(a)||this.tags.push(a),this},removeTag:function(a){return this.hasTag(a)&&this.tags.splice(this.tags.indexOf(a),1),this},hasTag:function(a){return this.tags.indexOf(a)>-1?!0:!1},destroy:function(){this.tags=[],this.clear(),this._events.destroy&&this._events.destroy(this)}})},"EntityManager.js":function(a,b,c){var d=c("./Base"),e=c("./Entity");b.exports=d.extend({initialize:function(a){a=a||{},this._entities=[],this.lastId=0,this.poolSize=0,this.marker=0;var b=a.poolSize||1e3;this.expandPool(b),this.poolSize=b},make:function(){this.marker>=this.poolSize&&this.expandPool(2*this.poolSize);var a=this._entities[this.marker++];return a.index=this.marker-1,a.id=++this.lastId,a},getById:function(a){for(var b=0;b<this._entities.length;b++)if(this._entities[b].id===a)return this._entities[b];return null},getByComponents:function(a){function b(b){for(var c=0;c<a.length;c++)if(-1===b.indexOf(a[c]))return!1;return!0}for(var c=[],d=this._entities.length;d--;){var e=this._entities[d].getAll();this._entities[d].id&&b(e)&&c.push(this._entities[d])}return c},get:function(a){if(isNaN(a)){var b=Array.isArray(a)?a:[a];return this.getByComponents(b)}return this.getById(a)},getTagged:function(a){for(var b=[],c=Array.isArray(a)?a:[a],d=this._entities.length;d--;)if(this._entities[d].id)for(var e=c.length;e--;)this._entities[d].hasTag(c[e])&&b.push(this._entities[d]);return b},expandPool:function(a){function b(a){c.destroyEntity(a)}for(var c=this,d=a-this.poolSize;d--;){var f=e.create();f.on("destroy",b),this._entities.push(f)}this.poolSize=a},destroyEntity:function(a){this.marker--;var b=this._entities[this.marker],c=b.index;this._entities[this.marker]=a,this._entities[a.index]=b,a.id=null,b.index=a.index,a.index=c}})},"Game.js":function(a,b,c){var d=c("./Base"),e=c("./EntityManager"),f=c("./GameTime");b.exports=d.extend({initialize:function(a){a=a||{},this._components={},this._systems=[],this.entities=e.create(a.poolSize),this.gameTime=new f,this.tLoop=null,this.paused=!1,this.boundGameRun=this.gameRun.bind(this)},addSystem:function(a){a.game=this,this._systems.push(a)},use:function(a,b){if(this._components.hasOwnProperty(a))throw new Error("component '"+a+"' already exist");this._components[a]=b},process:function(){for(var a=0;a<this._systems.length;a++){var b=this._systems[a],c=this.entities._entities;if(b.has&&b.has.length>0)c=this.entities.get(b.has);else{var d=c;c=[];for(var e=d.length;e--;)d[a].id&&c.push(c[a])}b.process(this.gameTime.frameTime,c)}},loop:function(){this.process()},start:function(){this.paused=!1,this.gameRun()},stop:function(){this.paused=!0,window.cancelAnimationFrame(this.tLoop)},gameRun:function(){this.gameTime.tick()&&this.loop(),this.tLoop=window.requestAnimationFrame(this.boundGameRun)}})},"GameTime.js":function(a,b){var c=b.exports=function(){this.lastTime=Date.now(),this.frameTime=0,this.typicalFrameTime=20,this.minFrameTime=12,this.time=0};c.prototype.tick=function(){var a=Date.now(),b=a-this.lastTime;return b<this.minFrameTime?!1:(this.frameTime=b>2*this.typicalFrameTime?this.typicalFrameTime:b,this.time+=this.frameTime,this.lastTime=a,!0)},c.prototype.reset=function(){this.lastTime=Date.now(),this.frameTime=0,this.typicalFrameTime=20,this.minFrameTime=12,this.time=0}},"System.js":function(a,b,c){var d=c("./Base");b.exports=d.extend({has:[],initialize:function(){},process:function(){}})},"index.js":function(a,b,c){var d=c("./Game");window.oaky={createGame:function(a){return d.create(a)},System:c("./System")}}}}})("oaky/lib/index");